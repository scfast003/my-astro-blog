---
import Card from '../../components/Card.astro';
import { FolderKanban, ArrowUpRight } from 'lucide-react';
import { getCollection } from "astro:content";

let recentProjects = [];
// 点击卡片始终跳转到项目列表页，因为卡片里可能有多个项目
const projectUrl = "/projects"; 

try {
  const projects = await getCollection("projects");
  
  if (projects && projects.length > 0) {
    // 1. 排序：按时间倒序
    // 2. 切片：只取前 2 个 (如果没有2个，它会自动返回实际数量，比如1个)
    recentProjects = projects.sort((a, b) => {
      const dateA = new Date(a.data.pubDate || 0).valueOf();
      const dateB = new Date(b.data.pubDate || 0).valueOf();
      return dateB - dateA;
    }).slice(0, 2);
  }
} catch (error) {
  console.log("未找到项目数据，显示默认内容");
}
---

<Card colSpan="md:col-span-1" rowSpan="md:row-span-1" href={projectUrl}>
  <div class="flex flex-col justify-between h-full p-4 hover:bg-primary/5 transition-colors group cursor-pointer">
    
    <div class="flex justify-between items-start mb-2">
      <div class="h-10 w-10 flex items-center justify-center rounded-lg bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400">
        <FolderKanban size={22} />
      </div>
      <ArrowUpRight className="text-gray-400 group-hover:text-primary group-hover:translate-x-1 group-hover:-translate-y-1 transition-transform" />
    </div>
    
    <div class="flex flex-col gap-3">
      {recentProjects.length > 0 ? (
        // 方案 A: 有项目数据 -> 显示紧凑列表 (最多2个)
        recentProjects.map((project, index) => (
          <div class="flex flex-col">
            <div class="flex items-center gap-2">
              <span class="font-bold text-sm text-gray-800 dark:text-gray-100 truncate">
                {project.data.title}
              </span>
              {/* 只给最新的第1个显示 NEW 标签 */}
              {index === 0 && (
                <span class="text-[10px] px-1 py-0.5 rounded bg-blue-100 text-blue-600 dark:bg-blue-900/50 dark:text-blue-300 font-bold leading-none">
                  NEW
                </span>
              )}
            </div>
            <span class="text-xs text-gray-500 dark:text-gray-400 truncate opacity-80">
              {project.data.description}
            </span>
          </div>
        ))
      ) : (
        // 方案 B: 无项目数据 -> 显示默认的大标题
        <div>
          <h2 class="text-lg font-bold text-gray-800 dark:text-gray-100">我的项目</h2>
          <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
            查看我的开源作品集与实战案例
          </p>
        </div>
      )}
    </div>
    
  </div>
</Card>
