---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// 1. 只获取 posts 和 projects 的数据
const posts = await getCollection('posts');
const projects = await getCollection('projects');

// 2. 合并这两个集合的标签
// 注意：删除了 books 和 experiences
const tags = [...posts, ...projects].reduce((acc, item) => {
  const itemTags = item.data.tags || [];
  itemTags.forEach((tag) => {
    if (!acc[tag]) {
      acc[tag] = 0;
    }
    acc[tag] += 1;
  });
  return acc;
}, {} as Record<string, number>);

const sortedTags = Object.keys(tags).sort((a, b) => a.localeCompare(b));
---

<BaseLayout title="标签云" description="所有文章和项目的标签索引">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8">标签索引</h1>
    <div class="flex flex-wrap gap-4">
      {sortedTags.map((tag) => (
        <a
          href={`/tags/${tag}`}
          class="px-4 py-2 border rounded-full hover:bg-primary hover:text-white transition-colors text-lg"
        >
          {tag} <span class="text-sm opacity-70 ml-1">({tags[tag]})</span>
        </a>
      ))}
    </div>
  </div>
</BaseLayout>