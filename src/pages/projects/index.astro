---
import ProjectCard from '../../components/ProjectCard.astro'
import { getCollection } from "astro:content";
import IndexPageLayout from "../../layouts/IndexPageLayout.astro";

// 1. 获取 projects 集合 (注意这里是 projects)
const projects = await getCollection('projects');

// 2. 排序 (按 pubDate 倒序)
projects.sort((a, b) => {
  return new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime();
});
---

<IndexPageLayout title="Projects" description="我的项目展示与开源作品" subTitle="我的项目">

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
    {
      projects.map((project) => (
        <ProjectCard
          key={project.slug}
          href={'/projects/' + project.slug}
          heading={project.data.title}
          subheading={project.data.description}
          
          /* --- 修复核心 --- */
          /* 这里原来是 project.data.image.alt，改为 title */
          altText={project.data.title} 
          
          /* 这里原来是 project.data.image.url，改为 heroImage */
          imagePath={project.data.heroImage}
          
          dateStart={project.data.pubDate}
        />
      ))
    }
  </div>

</IndexPageLayout>